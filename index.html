<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Tic Tac Toe</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(135deg, #141E30, #243B55);
      font: 500 16px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .card {
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 20px;
      padding: 24px;
      width: min(420px, 90%);
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    h1 { margin: 0 0 16px; font-size: 26px; }
    .btn {
      display: inline-block;
      padding: 12px 18px;
      margin: 8px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      color: #fff;
      background: linear-gradient(135deg, #06b6d4, #a78bfa);
    }
    .btn:hover { opacity: .9; }
    .input {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.2);
      margin: 10px 0;
      width: 80%;
      background: #0f172a;
      color: #fff;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin: 20px auto;
      max-width: 260px;
    }
    .cell {
      width: 80px; height: 80px;
      display: flex; align-items: center; justify-content: center;
      font-size: 2rem; font-weight: bold;
      border-radius: 12px;
      background: rgba(255,255,255,.1);
      cursor: pointer;
    }
    .cell[disabled] { opacity: .5; cursor: not-allowed; }
    .status { margin-top: 10px; font-weight: 600; }
  </style>
</head>
<body>
  <!-- Home Menu -->
  <div class="card" id="menu">
    <h1>Online Tic Tac Toe</h1>
    <button class="btn" id="hostBtn">Host Game</button>
    <button class="btn" id="joinBtn">Join Game</button>
    <button class="btn" id="aiBtn">Play vs Computer</button>
    <div id="joinBox" style="display:none;">
      <input class="input" id="codeInput" placeholder="Enter code" />
      <button class="btn" id="enterBtn">Join</button>
    </div>
  </div>

  <!-- Game Screen -->
  <div class="card" id="game" style="display:none;">
    <h1>Tic Tac Toe</h1>
    <div>Room Code: <b id="roomCode">â€”</b></div>
    <div class="grid" id="board"></div>
    <div class="status" id="statusLine">Connectingâ€¦</div>
    <button class="btn" id="resetBtn">Reset Game</button>
    <button class="btn" id="backBtn">Back to Menu</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    // ðŸ”‘ Replace with your Firebase config
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT-default-rtdb.firebaseio.com",
      projectId: "YOUR_PROJECT",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const uid = localStorage.getItem('ttt_uid') || (()=>{const u=crypto.randomUUID();localStorage.setItem('ttt_uid',u);return u})();
    const emptyBoard = Array(9).fill('');
    const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    let role = 'spectator', roomId = null, aiMode = false;
    const cells = [];
    const boardEl = document.getElementById('board');
    const statusEl = document.getElementById('statusLine');
    const roomCodeEl = document.getElementById('roomCode');

    for(let i=0;i<9;i++){
      const c = document.createElement('button');
      c.className = 'cell';
      c.addEventListener('click', ()=>makeMove(i));
      boardEl.appendChild(c);
      cells.push(c);
    }

    function randomRoomId(){ return Math.random().toString(36).slice(2,8).toUpperCase(); }

    document.getElementById('hostBtn').onclick = async ()=>{
      aiMode=false;
      roomId = randomRoomId();
      roomCodeEl.textContent = roomId;
      document.getElementById('menu').style.display='none';
      document.getElementById('game').style.display='block';
      const ref = db.ref('rooms/'+roomId);
      await ref.set({board:emptyBoard, turn:'X', status:'waiting', players:{X:uid,O:''}});
      role='X';
      ref.on('value', snap=>{ if(snap.exists()) updateUI(snap.val()); });
    };

    document.getElementById('joinBtn').onclick = ()=>{
      document.getElementById('joinBox').style.display='block';
    };

    document.getElementById('enterBtn').onclick = async ()=>{
      aiMode=false;
      const code = document.getElementById('codeInput').value.trim().toUpperCase();
      if(!code) return;
      roomId = code;
      roomCodeEl.textContent = roomId;
      document.getElementById('menu').style.display='none';
      document.getElementById('game').style.display='block';
      const ref = db.ref('rooms/'+roomId);
      const snap = await ref.get();
      if(!snap.exists()){ alert("Room not found!"); location.reload(); return; }
      const g = snap.val();
      if(!g.players.O){ await ref.child('players/O').set(uid); role='O'; }
      else if(g.players.X===uid) role='X';
      else if(g.players.O===uid) role='O';
      else role='spectator';
      ref.on('value', snap=>{ if(snap.exists()) updateUI(snap.val()); });
    };

    document.getElementById('aiBtn').onclick = ()=>{
      aiMode=true;
      roomId="LOCAL_AI";
      role="X";
      roomCodeEl.textContent="AI";
      document.getElementById('menu').style.display='none';
      document.getElementById('game').style.display='block';
      updateUI({board:emptyBoard, turn:"X", status:"playing"});
    };

    async function makeMove(i){
      if(aiMode){
        if(cells[i].textContent) return;
        cells[i].textContent=role;
        let winner=checkWinner(getBoard());
        if(winner){ showResult(winner); return; }
        aiMove();
        winner=checkWinner(getBoard());
        if(winner){ showResult(winner); }
        return;
      }
      const ref = db.ref('rooms/'+roomId);
      const snap = await ref.get();
      if(!snap.exists()) return;
      const g = snap.val();
      if(g.status!=='playing'||g.turn!==role||g.board[i]) return;
      const nb = g.board.slice(); nb[i]=role;
      const w = checkWinner(nb);
      const updates={board:nb,turn:(role==='X'?'O':'X')};
      if(w){ updates.status=w==='draw'?'draw':w+'_won'; updates.turn='â€”'; }
      await ref.update(updates);
    }

    function getBoard(){ return cells.map(c=>c.textContent); }
    function aiMove(){
      let board=getBoard();
      // Simple AI: block or win
      for(let [a,b,c] of wins){
        if(board[a]==="O"&&board[b]==="O"&&!board[c]){cells[c].textContent="O";return;}
        if(board[a]==="O"&&board[c]==="O"&&!board[b]){cells[b].textContent="O";return;}
        if(board[b]==="O"&&board[c]==="O"&&!board[a]){cells[a].textContent="O";return;}
      }
      for(let [a,b,c] of wins){
        if(board[a]==="X"&&board[b]==="X"&&!board[c]){cells[c].textContent="O";return;}
        if(board[a]==="X"&&board[c]==="X"&&!board[b]){cells[b].textContent="O";return;}
        if(board[b]==="X"&&board[c]==="X"&&!board[a]){cells[a].textContent="O";return;}
      }
      let empty=board.map((v,i)=>v?null:i).filter(x=>x!==null);
      if(empty.length){ let choice=empty[Math.floor(Math.random()*empty.length)]; cells[choice].textContent="O"; }
    }

    function checkWinner(b){
      for(const [a,b2,c] of wins){ if(b[a]&&b[a]===b[b2]&&b[a]===b[c]) return b[a]; }
      if(b.every(x=>x)) return 'draw'; return null;
    }

    function updateUI(g){
      g.board.forEach((v,i)=>{ cells[i].textContent=v; });
      const myTurn = role!=='spectator' && g.turn===role && g.status==='playing';
      cells.forEach((c,i)=> c.disabled=!(myTurn && !g.board[i]));
      if(g.status==='waiting'){ statusEl.textContent='Waiting for opponentâ€¦'; }
      else if(g.status==='playing'){ statusEl.textContent = (g.turn===role? 'Your move!' : 'Opponentâ€™s moveâ€¦'); }
      else if(g.status==='X_won'||g.status==='O_won'){ statusEl.textContent=(role===g.status[0]? 'You win!' : (role==='spectator'? g.status[0]+' wins!' : 'You lose.')); }
      else if(g.status==='draw'){ statusEl.textContent='Draw.'; }
    }

    function showResult(winner){
      if(winner==="draw") statusEl.textContent="Draw!";
      else statusEl.textContent=(winner===role?"You win!":"You lose.");
    }

    document.getElementById('resetBtn').onclick = ()=>{
      if(aiMode){
        cells.forEach(c=>c.textContent="");
        statusEl.textContent="Your move!";
      } else {
        if(roomId) db.ref('rooms/'+roomId).update({board:emptyBoard,status:'waiting',turn:'X'});
      }
    };
    document.getElementById('backBtn').onclick = ()=>{
      document.getElementById('game').style.display='none';
      document.getElementById('menu').style.display='block';
      cells.forEach(c=>c.textContent="");
      statusEl.textContent="Connectingâ€¦";
    };
  </script>
</body>
</html>
